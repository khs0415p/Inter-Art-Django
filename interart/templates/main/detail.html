{% extends 'base.html' %}
{% block content %}
{% include 'navbar.html' %}
 <div class="pt-5 container">
    {% if messages %}
    <div class="alert alert-danger my-3" role="alert">
        {% for message in messages %}
        <strong>
            {{ messages.tags }}
        </strong>
        <ul>
            <li>
                {{ message.message }}
            </li>
        </ul>
        {% endfor %}
    </div>
    {% endif %}
    <div class="top">
        <h1>제목 : {{ post.title }}</h1>
        <p>작성자 : {{ post.user }}</p>
        {% if request.user == post.user %}
        <a href="{% url 'main:post_modify' post.id %}" class="btn btn-outline-secondary">수정</a>
        <a href="javascript:void(0)" data-uri="{% url 'main:post_delete' post.id %}" class="delete btn btn-outline-secondary">삭제</a>
        {% endif %}
    </div>
    {% if post.image %}
        <div class="image-box" style="width 80%; height: auto">
            <img src="{{ post.image.url }}" alt="" style="width: 100%; height: 100%">
        </div>
    {% endif %}
    <div class="middle">
        {{ post.content }}
        <p>여기까지가 본문 내용</p>
    </div>
    <div class="like-box">
        <form action="{% url 'main:likes' post.id %}" method="POST">
            {% csrf_token %}
            {% if user in post.like_user.all %}
            <input type="submit" value="좋아요 취소">
            {% else %}
            <input type="submit" value="좋아요">
            {% endif %}
            {{ post.like_user.count }}
        </form>
    </div>
    <div class="comment-box">
        <form action="{% url 'main:detail' post.id %}" method="POST">
            {% csrf_token %}
            <input {% if not user.is_authenticated %} disabled {% endif %} type="text" name="comment" placeholder="댓글을 입력해주세요.">
            <input {% if not user.is_authenticated %} disabled {% endif %} type="submit" value="댓글등록">
        </form>
    </div>
    <div class="comment-list">
        <p>댓글 수: {{ post.comment_set.count }}</p>
        {% for item in post.comment_set.all %}
        <div class="comment">{{ item.user}} {{ item.comment }}</div>
        <div>
            {% if request.user == item.user %}
            <a href="{% url 'main:comment_modify' item.id %}" class="btn btn-outline-secondary">수정</a>
            <a class="delete btn btn-outline-secondary" data-uri="{% url 'main:comment_delete' item.id %}" href="javascript:void(0)">삭제</a>
            {% endif %}
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}
{% block script %}
<script type="text/javascript">
const delete_elements = document.getElementsByClassName("delete");
Array.from(delete_elements).forEach(function(element) {
    element.addEventListener('click', function() {
        if(confirm("정말로 삭제하시겠습니까?")) {
            location.href = this.dataset.uri;
        };
    });
});
</script>
{% endblock %}